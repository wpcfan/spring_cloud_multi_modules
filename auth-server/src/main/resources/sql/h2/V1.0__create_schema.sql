SET REFERENTIAL_INTEGRITY FALSE;

CREATE TABLE "UAA_AUTHORIZATION_CONSENTS"(

    "AUTHORITIES" CHARACTER VARYING(1000),

    "PRINCIPAL_NAME" CHARACTER VARYING(255) NOT NULL,

    "REGISTERED_CLIENT_ID" CHARACTER VARYING(255) NOT NULL

);
ALTER TABLE "UAA_AUTHORIZATION_CONSENTS" ADD CONSTRAINT "PK_AUTHORIZATION_CONSENTS_PRINCIPAL_NAME_REGISTERED_CLIENT_ID" PRIMARY KEY("PRINCIPAL_NAME", "REGISTERED_CLIENT_ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.AUTHORIZATION_CONSENTS;
CREATE TABLE "UAA_AUTHORIZATIONS"(

    "ACCESS_TOKEN_EXPIRES_AT" TIMESTAMP(6) WITH TIME ZONE,

    "ACCESS_TOKEN_ISSUED_AT" TIMESTAMP(6) WITH TIME ZONE,

    "AUTHORIZATION_CODE_EXPIRES_AT" TIMESTAMP(6) WITH TIME ZONE,

    "AUTHORIZATION_CODE_ISSUED_AT" TIMESTAMP(6) WITH TIME ZONE,

    "DEVICE_CODE_EXPIRES_AT" TIMESTAMP(6) WITH TIME ZONE,

    "DEVICE_CODE_ISSUED_AT" TIMESTAMP(6) WITH TIME ZONE,

    "OIDC_ID_TOKEN_EXPIRES_AT" TIMESTAMP(6) WITH TIME ZONE,

    "OIDC_ID_TOKEN_ISSUED_AT" TIMESTAMP(6) WITH TIME ZONE,

    "REFRESH_TOKEN_EXPIRES_AT" TIMESTAMP(6) WITH TIME ZONE,

    "REFRESH_TOKEN_ISSUED_AT" TIMESTAMP(6) WITH TIME ZONE,

    "USER_CODE_EXPIRES_AT" TIMESTAMP(6) WITH TIME ZONE,

    "USER_CODE_ISSUED_AT" TIMESTAMP(6) WITH TIME ZONE,

    "STATE" CHARACTER VARYING(500),

    "ACCESS_TOKEN_SCOPES" CHARACTER VARYING(1000),

    "AUTHORIZED_SCOPES" CHARACTER VARYING(1000),

    "ACCESS_TOKEN_METADATA" CHARACTER VARYING(2000),

    "DEVICE_CODE_METADATA" CHARACTER VARYING(2000),

    "OIDC_ID_TOKEN_CLAIMS" CHARACTER VARYING(2000),

    "OIDC_ID_TOKEN_METADATA" CHARACTER VARYING(2000),

    "REFRESH_TOKEN_METADATA" CHARACTER VARYING(2000),

    "USER_CODE_METADATA" CHARACTER VARYING(2000),

    "ACCESS_TOKEN_VALUE" CHARACTER VARYING(4000),

    "ATTRIBUTES" CHARACTER VARYING(4000),

    "AUTHORIZATION_CODE_VALUE" CHARACTER VARYING(4000),

    "DEVICE_CODE_VALUE" CHARACTER VARYING(4000),

    "OIDC_ID_TOKEN_VALUE" CHARACTER VARYING(4000),

    "REFRESH_TOKEN_VALUE" CHARACTER VARYING(4000),

    "USER_CODE_VALUE" CHARACTER VARYING(4000),

    "ACCESS_TOKEN_TYPE" CHARACTER VARYING(255),

    "AUTHORIZATION_CODE_METADATA" CHARACTER VARYING(255),

    "AUTHORIZATION_GRANT_TYPE" CHARACTER VARYING(255),

    "ID" CHARACTER VARYING(255) NOT NULL,

    "PRINCIPAL_NAME" CHARACTER VARYING(255),

    "REGISTERED_CLIENT_ID" CHARACTER VARYING(255)

);
ALTER TABLE "UAA_AUTHORIZATIONS" ADD CONSTRAINT "PK_AUTHORIZATIONS_ID" PRIMARY KEY("ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.AUTHORIZATIONS;
CREATE TABLE "UAA_CLIENTS"(

    "CLIENT_ID_ISSUED_AT" TIMESTAMP(6) WITH TIME ZONE,

    "CLIENT_SECRET_EXPIRES_AT" TIMESTAMP(6) WITH TIME ZONE,

    "AUTHORIZATION_GRANT_TYPES" CHARACTER VARYING(1000),

    "CLIENT_AUTHENTICATION_METHODS" CHARACTER VARYING(1000),

    "POST_LOGOUT_REDIRECT_URIS" CHARACTER VARYING(1000),

    "REDIRECT_URIS" CHARACTER VARYING(1000),

    "SCOPES" CHARACTER VARYING(1000),

    "CLIENT_SETTINGS" CHARACTER VARYING(2000),

    "TOKEN_SETTINGS" CHARACTER VARYING(2000),

    "CLIENT_ID" CHARACTER VARYING(255),

    "CLIENT_NAME" CHARACTER VARYING(255),

    "CLIENT_SECRET" CHARACTER VARYING(255),

    "ID" CHARACTER VARYING(255) NOT NULL

);
ALTER TABLE "UAA_CLIENTS" ADD CONSTRAINT "PK_CLIENTS_ID" PRIMARY KEY("ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.CLIENTS;
CREATE TABLE "UAA_GROUPS"(

    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,

    "GROUP_NAME" CHARACTER VARYING(50) NOT NULL,

    "DISPLAY_NAME" CHARACTER VARYING(100) NOT NULL

);
ALTER TABLE "UAA_GROUPS" ADD CONSTRAINT "PK_GROUPS_ID" PRIMARY KEY("ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC."GROUPS";
CREATE TABLE "UAA_GROUPS_ROLES"(

    "GROUP_ID" BIGINT NOT NULL,

    "ROLE_ID" BIGINT NOT NULL

);
ALTER TABLE "UAA_GROUPS_ROLES" ADD CONSTRAINT "PK_GROUPS_ROLES_GROUP_ID_ROLE_ID" PRIMARY KEY("GROUP_ID", "ROLE_ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.GROUPS_ROLES;
CREATE TABLE "UAA_PERMISSIONS"(

    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,

    "DISPLAY_NAME" CHARACTER VARYING(50) NOT NULL,

    "PERMISSION_NAME" CHARACTER VARYING(50) NOT NULL

);
ALTER TABLE "UAA_PERMISSIONS" ADD CONSTRAINT "PK_PERMISSIONS_ID" PRIMARY KEY("ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PERMISSIONS;
CREATE TABLE "UAA_ROLES"(

    "BUILT_IN" BOOLEAN NOT NULL,

    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,

    "DISPLAY_NAME" CHARACTER VARYING(50) NOT NULL,

    "ROLE_NAME" CHARACTER VARYING(50) NOT NULL

);
ALTER TABLE "UAA_ROLES" ADD CONSTRAINT "PK_ROLES_ID" PRIMARY KEY("ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.ROLES;
CREATE TABLE "UAA_ROLES_PERMISSIONS"(

    "PERMISSION_ID" BIGINT NOT NULL,

    "ROLE_ID" BIGINT NOT NULL

);
ALTER TABLE "UAA_ROLES_PERMISSIONS" ADD CONSTRAINT "PK_ROLES_PERMISSIONS_PERMISSION_ID_ROLE_ID" PRIMARY KEY("PERMISSION_ID", "ROLE_ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.ROLES_PERMISSIONS;
CREATE TABLE "UAA_USER_PROFILES"(

    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,

    "USER_ID" BIGINT NOT NULL,

    "MOBILE" CHARACTER VARYING(11) NOT NULL,

    "NAME" CHARACTER VARYING(50) NOT NULL,

    "EMAIL" CHARACTER VARYING(254) NOT NULL

);
ALTER TABLE "UAA_USER_PROFILES" ADD CONSTRAINT "PK_USER_PROFILES_ID" PRIMARY KEY("ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.USER_PROFILES;
CREATE TABLE "UAA_USERS"(
    "MFA_ENABLED" BOOLEAN NOT NULL,

    "TOTP_SECRET" CHARACTER VARYING(16),

    "ACCOUNT_NON_EXPIRED" BOOLEAN NOT NULL,

    "ACCOUNT_NON_LOCKED" BOOLEAN NOT NULL,

    "CREDENTIALS_NON_EXPIRED" BOOLEAN NOT NULL,

    "ENABLED" BOOLEAN NOT NULL,

    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,

    "USERNAME" CHARACTER VARYING(50) NOT NULL,

    "PASSWORD_HASH" CHARACTER VARYING(80) NOT NULL

);
ALTER TABLE "UAA_USERS" ADD CONSTRAINT "PK_USERS_ID" PRIMARY KEY("ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.USERS;
CREATE TABLE "UAA_USERS_GROUPS"(

    "GROUP_ID" BIGINT NOT NULL,

    "USER_ID" BIGINT NOT NULL

);
ALTER TABLE "UAA_USERS_GROUPS" ADD CONSTRAINT "PK_GROUP_ID_USER_ID" PRIMARY KEY("GROUP_ID", "USER_ID");
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.USERS_GROUPS;
ALTER TABLE "UAA_ROLES" ADD CONSTRAINT "UNIQUE_ROLES_ROLE_NAME" UNIQUE("ROLE_NAME");
ALTER TABLE "UAA_USER_PROFILES" ADD CONSTRAINT "UNIQUE_USER_PROFILES_USER_ID" UNIQUE("USER_ID");
ALTER TABLE "UAA_USER_PROFILES" ADD CONSTRAINT "UNIQUE_USER_PROFILES_EMAIL)" UNIQUE("EMAIL");
ALTER TABLE "UAA_USERS" ADD CONSTRAINT "UNIQUE_USERS_USERNAME" UNIQUE("USERNAME");
ALTER TABLE "UAA_GROUPS" ADD CONSTRAINT "UNIQUE_GROUPS_GROUP_NAME" UNIQUE("GROUP_NAME");
ALTER TABLE "UAA_USER_PROFILES" ADD CONSTRAINT "UNIQUE_USER_PROFILES_MOBILE" UNIQUE("MOBILE");
ALTER TABLE "UAA_PERMISSIONS" ADD CONSTRAINT "UNIQUE_PERMISSIONS_PERMISSION_NAME" UNIQUE("PERMISSION_NAME");
ALTER TABLE "UAA_GROUPS_ROLES" ADD CONSTRAINT "FK_GROUPS_ROLES_ROLE_ID" FOREIGN KEY("ROLE_ID") REFERENCES "UAA_ROLES"("ID") NOCHECK;
ALTER TABLE "UAA_GROUPS_ROLES" ADD CONSTRAINT "FK_GROUPS_ROLES_GROUP_ID" FOREIGN KEY("GROUP_ID") REFERENCES "UAA_GROUPS"("ID") NOCHECK;
ALTER TABLE "UAA_USERS_GROUPS" ADD CONSTRAINT "FK_USERS_GROUPS_USER_ID" FOREIGN KEY("USER_ID") REFERENCES "UAA_USERS"("ID") NOCHECK;
ALTER TABLE "UAA_USERS_GROUPS" ADD CONSTRAINT "FK_USERS_GROUPS_GROUP_ID" FOREIGN KEY("GROUP_ID") REFERENCES "UAA_GROUPS"("ID") NOCHECK;
ALTER TABLE "UAA_USER_PROFILES" ADD CONSTRAINT "FK_USER_PROFILES_USER_ID" FOREIGN KEY("USER_ID") REFERENCES "UAA_USERS"("ID") NOCHECK;
ALTER TABLE "UAA_ROLES_PERMISSIONS" ADD CONSTRAINT "FK_ROLES_PERMISSIONS_ROLE_ID" FOREIGN KEY("ROLE_ID") REFERENCES "UAA_ROLES"("ID") NOCHECK;
ALTER TABLE "UAA_ROLES_PERMISSIONS" ADD CONSTRAINT "FK_ROLES_PERMISSIONS_PERMISSION_ID" FOREIGN KEY("PERMISSION_ID") REFERENCES "UAA_PERMISSIONS"("ID") NOCHECK;
SET REFERENTIAL_INTEGRITY TRUE;
